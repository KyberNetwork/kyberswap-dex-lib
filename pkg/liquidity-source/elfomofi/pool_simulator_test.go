package elfomofi

import (
	"encoding/json"
	"testing"

	"github.com/samber/lo"

	"github.com/KyberNetwork/kyberswap-dex-lib/pkg/entity"
	"github.com/KyberNetwork/kyberswap-dex-lib/pkg/util/testutil"
)

var (
	entityPool entity.Pool
	_          = json.Unmarshal([]byte("{\"address\":\"elfomofi_0x4200000000000000000000000000000000000006_0x833589fcd6edb6e08f4c7c32d4f71b54bda02913\",\"exchange\":\"elfomofi\",\"type\":\"elfomofi\",\"timestamp\":1768382669,\"reserves\":[\"6950940416823151180\",\"133555180156\"],\"tokens\":[{\"address\":\"0x4200000000000000000000000000000000000006\",\"symbol\":\"WETH\",\"decimals\":18,\"swappable\":true},{\"address\":\"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913\",\"symbol\":\"USDC\",\"decimals\":6,\"swappable\":true}],\"extra\":\"{\\\"samples\\\":[[[100000000000,331],[1000000000000,3328],[10000000000000,33288],[100000000000000,332889],[1000000000000000,3328911],[10000000000000000,33289138],[100000000000000000,332891389],[1000000000000000000,3328913908],[10000000000000000000,6851908261],[100000000000000000000,133555180156],[1000000000000000000000,133555180156],[10000000000000000000000,133555180156],[100000000000000000000000,133555180156],[1000000000000000000000000,133555180156],[10000000000000000000000000,133555180156]],[[1,300043335],[10,3000433368],[100,30004333709],[1000,300043337110],[10000,3000433371110],[100000,30004333711126],[1000000,300043337111280],[10000000,3000433371112822],[100000000,30004333711128233],[1000000000,300043337111282351],[10000000000,3000133297768377799],[100000000000,6950940416823151180],[1000000000000,6950940416823151180],[10000000000000,6950940416823151180],[100000000000000,6950940416823151180]]]}\"}"),
		&entityPool)
	poolSim = lo.Must(NewPoolSimulator(entityPool))
)

func TestPoolSimulator_CalcAmountOut(t *testing.T) {
	t.Parallel()
	testutil.TestCalcAmountOut(t, poolSim, map[int]map[int]map[string]string{
		1: {
			0: {
				"3005810": "901873263122456",
			},
		},
		0: {
			1: {
				"1000000000000000": "3328911",
			},
		},
	})
}
