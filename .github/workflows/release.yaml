name: 'Release'

permissions: write-all

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Release version'
        type: string
        required: true
      create_tag:
        description: 'Whether to create tag and release'
        type: boolean
        default: true

jobs:
  release:
    if: github.ref == 'refs/heads/release' # Merge or fast-forward 'release' to 'main' and release from there
    uses: KyberNetwork/service-framework/.github/workflows/release.yaml@main
    with:
      service: ${{ github.event.repository.name }}
      version: '${{ inputs.version }}'
      file: docker/Dockerfile
      create_tag: ${{ inputs.create_tag }}
    secrets: inherit
  release_liqIndexer:
    if: github.ref == 'refs/heads/release' # Merge or fast-forward 'release' to 'main' and release from there
    uses: KyberNetwork/service-framework/.github/workflows/release.yaml@main
    with:
      service: ${{ github.event.repository.name }}-liqindexer
      version: '${{ inputs.version }}'
      file: docker/liqIndexer.Dockerfile
      create_tag: false
    secrets: inherit
