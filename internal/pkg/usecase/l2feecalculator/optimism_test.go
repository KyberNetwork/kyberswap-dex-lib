package l2feecalculator

import (
	"math/big"
	"testing"

	"github.com/ethereum/go-ethereum/common"
	"github.com/stretchr/testify/assert"

	"github.com/KyberNetwork/router-service/internal/pkg/entity"
)

func TestOptimismL2FeeCalculator_CreateRawTxFromInputData(t *testing.T) {
	testCases := []struct {
		name            string
		encodedSwapData string
		expectedResult  string
		expectErr       error
	}{
		{
			name:            "it should return correct raw transaction",
			encodedSwapData: "0xe21fd0e900000000000000000000000000000000000000000000000000000000000000200000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000a600000000000000000000000000000000000000000000000000000000000000c6000000000000000000000000000000000000000000000000000000000000009a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c3160700000000000000000000000000000000000000000000000000000003cdbb20ea0000000000000000000000006131b5fae19ea4f9d964eac0408e4408b66337b50000000000000000000000000000000000000000000000000000000063e0bb42000000000000000000000000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000005400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd00000000000000000000000085149247691df622eaf1a8bd0cafd40bc45154a900000000000000000000000042000000000000000000000000000000000000060000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c3160700000000000000000000000000000000000000000000000075f610f70ed200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000040cbf622d3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000120000000000000000000000000b90b9b1f91a01ea22a182cd84c1e22222e39b415000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000001f32b1c2345538c0c6f582fcb022739c4a194ebb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000de0b6b3a764000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd0000000000000000000000005fc53f707c7aacd460a1cd564c06e0f07610fcb70000000000000000000000001f32b1c2345538c0c6f582fcb022739c4a194ebb0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000000000000000000000000000000c8cf311c70e030e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd00000000000000000000000095d9d28606ee55de7667f0f176ebfc3215cfd9c00000000000000000000000004200000000000000000000000000000000000006000000000000000000000000da10009cbd5d07dd0cecc66161fc93d7c9000da100000000000000000000000000000000000000000000000006f05b59d3b2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd000000000000000000000000427464d9434f99a3d942c60210ee2376166975ce000000000000000000000000da10009cbd5d07dd0cecc66161fc93d7c9000da10000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c3160700000000000000000000000000000000000000000000002c4ecdb290026862e20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000006bb030922f22fed1038951bcaf6ea40983b49ab20000000000000000000000000000000000000000000000008ac7230489e8000000000000000000000000000000000000000000000000000000000003cdbb20ea000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ef7b22536f75726365223a226b7962657273776170222c22416d6f756e74496e555344223a2231363239352e31222c22416d6f756e744f7574555344223a2231363334332e393630323533343837383138222c22526566657272616c223a22222c22466c616773223a332c22496e74656772697479496e666f223a7b224b65794944223a2231222c225369676e6174757265223a2241765936693656494d7951477776767671476d6f41524c5773522f2b45337756737278394650694a6b4a6772705a3376376a32494c584269454a5439746b79443045724b75456a4e446471434375736c6f6b5a594c6a316739686c31374a3432624f334249594b49776754364f484159366c674644725864743653334254462f4d637651566a79486c6c454b5770687432495950665477587454487052392b63576d637461624a6d6c4c425848313450726c2b51736a6f74475855493550347139652f52626c6e4674315a5036545074554d6f376b6c4e36535a4c747052596677664e55365432544143734c5056326870626479727471742f5059692b7750526b3566616847674d43476e5935497a33314f6b71373778496465764d547267335268574c2f2b564562325539754135316374696b74626162756a766d733468783959454e70484c34514d4c6e33484c774d6544396f773d3d227d7d0000000000000000000000000000000000",
			expectedResult:  "f90f12808503c0781e79825208944592d8f8d7b001e72cb26a73e4fa1806a51ac79d880de0b6b3a7640000b90ea4e21fd0e900000000000000000000000000000000000000000000000000000000000000200000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000a600000000000000000000000000000000000000000000000000000000000000c6000000000000000000000000000000000000000000000000000000000000009a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c3160700000000000000000000000000000000000000000000000000000003cdbb20ea0000000000000000000000006131b5fae19ea4f9d964eac0408e4408b66337b50000000000000000000000000000000000000000000000000000000063e0bb42000000000000000000000000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000005400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd00000000000000000000000085149247691df622eaf1a8bd0cafd40bc45154a900000000000000000000000042000000000000000000000000000000000000060000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c3160700000000000000000000000000000000000000000000000075f610f70ed200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000040cbf622d3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000120000000000000000000000000b90b9b1f91a01ea22a182cd84c1e22222e39b415000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000001f32b1c2345538c0c6f582fcb022739c4a194ebb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000de0b6b3a764000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd0000000000000000000000005fc53f707c7aacd460a1cd564c06e0f07610fcb70000000000000000000000001f32b1c2345538c0c6f582fcb022739c4a194ebb0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000000000000000000000000000000c8cf311c70e030e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd00000000000000000000000095d9d28606ee55de7667f0f176ebfc3215cfd9c00000000000000000000000004200000000000000000000000000000000000006000000000000000000000000da10009cbd5d07dd0cecc66161fc93d7c9000da100000000000000000000000000000000000000000000000006f05b59d3b2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd000000000000000000000000427464d9434f99a3d942c60210ee2376166975ce000000000000000000000000da10009cbd5d07dd0cecc66161fc93d7c9000da10000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c3160700000000000000000000000000000000000000000000002c4ecdb290026862e20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000006bb030922f22fed1038951bcaf6ea40983b49ab20000000000000000000000000000000000000000000000008ac7230489e8000000000000000000000000000000000000000000000000000000000003cdbb20ea000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ef7b22536f75726365223a226b7962657273776170222c22416d6f756e74496e555344223a2231363239352e31222c22416d6f756e744f7574555344223a2231363334332e393630323533343837383138222c22526566657272616c223a22222c22466c616773223a332c22496e74656772697479496e666f223a7b224b65794944223a2231222c225369676e6174757265223a2241765936693656494d7951477776767671476d6f41524c5773522f2b45337756737278394650694a6b4a6772705a3376376a32494c584269454a5439746b79443045724b75456a4e446471434375736c6f6b5a594c6a316739686c31374a3432624f334249594b49776754364f484159366c674644725864743653334254462f4d637651566a79486c6c454b5770687432495950665477587454487052392b63576d637461624a6d6c4c425848313450726c2b51736a6f74475855493550347139652f52626c6e4674315a5036545074554d6f376b6c4e36535a4c747052596677664e55365432544143734c5056326870626479727471742f5059692b7750526b3566616847674d43476e5935497a33314f6b71373778496465764d547267335268574c2f2b564562325539754135316374696b74626162756a766d733468783959454e70484c34514d4c6e33484c774d6544396f773d3d227d7d000000000000000000000000000000000037a0f57cd7a001f04bf54baa8fc2e8f58bc5aad18a93aa9ad7d875bc97e7c108c42fa043704a69589c066f5c84a6a12bc8401bdc827fc1aa80ab283a154ad3d9cdee71",
			expectErr:       nil,
		},
		{
			name:            "it should return correct raw transaction (2)",
			encodedSwapData: "0xabcffc26000000000000000000000000be13e651ff246ac63fa36cad6cd8610b090a6a25000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000520000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c31607000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001400000000000000000000000006bb030922f22fed1038951bcaf6ea40983b49ab20000000000000000000000000000000000000000000000000de0b6b3a764000000000000000000000000000000000000000000000000000000000000604c787c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c3160700000000000000000000000000000000000000000000000000000000604c787c0000000000000000000000006bb030922f22fed1038951bcaf6ea40983b49ab20000000000000000000000000000000000000000000000000000000063e1209400000000000000000000000000000000000000000000000000000000000002c00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000005010000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000085149247691df622eaf1a8bd0cafd40bc45154a900000000000000000000000042000000000000000000000000000000000000060000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001367b22536f75726365223a226b7962657273776170222c22416d6f756e74496e555344223a2230222c22416d6f756e744f7574555344223a22313632332e373032343338222c22526566657272616c223a22222c22466c616773223a322c22496e74656772697479496e666f223a7b224b65794944223a2231222c225369676e6174757265223a22655832484c526869687a5739452f5a4a4a6b7179653059664a5965414e6f68784d7477305a327a76377a7147566a36705a4a7a5a45363972425a55704c5a477a627262434452575031514b49783149425a765a69727655543257556959457a334c6b742f506273474439637571594762455270585653714763764533564b42433145416e76496b3748725156504359464762734f536d433968396242773736576743336b2f3531303539413d227d7d00000000000000000000",
			expectedResult:  "f906f2808503c0781e79825208944592d8f8d7b001e72cb26a73e4fa1806a51ac79d880de0b6b3a7640000b90684abcffc26000000000000000000000000be13e651ff246ac63fa36cad6cd8610b090a6a25000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000520000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c31607000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001400000000000000000000000006bb030922f22fed1038951bcaf6ea40983b49ab20000000000000000000000000000000000000000000000000de0b6b3a764000000000000000000000000000000000000000000000000000000000000604c787c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c3160700000000000000000000000000000000000000000000000000000000604c787c0000000000000000000000006bb030922f22fed1038951bcaf6ea40983b49ab20000000000000000000000000000000000000000000000000000000063e1209400000000000000000000000000000000000000000000000000000000000002c00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000005010000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000085149247691df622eaf1a8bd0cafd40bc45154a900000000000000000000000042000000000000000000000000000000000000060000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001367b22536f75726365223a226b7962657273776170222c22416d6f756e74496e555344223a2230222c22416d6f756e744f7574555344223a22313632332e373032343338222c22526566657272616c223a22222c22466c616773223a322c22496e74656772697479496e666f223a7b224b65794944223a2231222c225369676e6174757265223a22655832484c526869687a5739452f5a4a4a6b7179653059664a5965414e6f68784d7477305a327a76377a7147566a36705a4a7a5a45363972425a55704c5a477a627262434452575031514b49783149425a765a69727655543257556959457a334c6b742f506273474439637571594762455270585653714763764533564b42433145416e76496b3748725156504359464762734f536d433968396242773736576743336b2f3531303539413d227d7d0000000000000000000037a08317320e7e564d797faad962e849632053ee31e2e3a4682d6eec8b2ae49e68cba02f2164b9838cfd1199b1646e59821ceba76e2fbd9a6947d3a79cd331e404e8eb",
			expectErr:       nil,
		},
	}

	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			l2FeeOptimism := NewOptimismFeeCalculator()
			l2FeeOptimism.SetParams(&entity.L2Fee{
				Decimals:  big.NewInt(6),
				L1BaseFee: big.NewInt(16113999481),
				Overhead:  big.NewInt(2100),
				Scalar:    big.NewInt(1000000),
			})

			result, err := l2FeeOptimism.CreateRawTxFromInputData(tc.encodedSwapData)

			assert.ErrorIs(t, tc.expectErr, err)

			assert.Equal(t, tc.expectedResult, common.Bytes2Hex(result))
		})
	}
}

func TestOptimismL2FeeCalculator_GetL1GasUsed(t *testing.T) {
	testCases := []struct {
		name           string
		rawTx          string
		expectedResult *big.Int
	}{
		{
			name:           "it should return correct value",
			rawTx:          "f90f12808503c0781e79825208944592d8f8d7b001e72cb26a73e4fa1806a51ac79d880de0b6b3a7640000b90ea4e21fd0e900000000000000000000000000000000000000000000000000000000000000200000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000a600000000000000000000000000000000000000000000000000000000000000c6000000000000000000000000000000000000000000000000000000000000009a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c3160700000000000000000000000000000000000000000000000000000003cdbb20ea0000000000000000000000006131b5fae19ea4f9d964eac0408e4408b66337b50000000000000000000000000000000000000000000000000000000063e0bb42000000000000000000000000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000005400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd00000000000000000000000085149247691df622eaf1a8bd0cafd40bc45154a900000000000000000000000042000000000000000000000000000000000000060000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c3160700000000000000000000000000000000000000000000000075f610f70ed200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000040cbf622d3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000120000000000000000000000000b90b9b1f91a01ea22a182cd84c1e22222e39b415000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000001f32b1c2345538c0c6f582fcb022739c4a194ebb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000de0b6b3a764000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd0000000000000000000000005fc53f707c7aacd460a1cd564c06e0f07610fcb70000000000000000000000001f32b1c2345538c0c6f582fcb022739c4a194ebb0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000000000000000000000000000000c8cf311c70e030e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd00000000000000000000000095d9d28606ee55de7667f0f176ebfc3215cfd9c00000000000000000000000004200000000000000000000000000000000000006000000000000000000000000da10009cbd5d07dd0cecc66161fc93d7c9000da100000000000000000000000000000000000000000000000006f05b59d3b2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd000000000000000000000000427464d9434f99a3d942c60210ee2376166975ce000000000000000000000000da10009cbd5d07dd0cecc66161fc93d7c9000da10000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c3160700000000000000000000000000000000000000000000002c4ecdb290026862e20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000006bb030922f22fed1038951bcaf6ea40983b49ab20000000000000000000000000000000000000000000000008ac7230489e8000000000000000000000000000000000000000000000000000000000003cdbb20ea000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ef7b22536f75726365223a226b7962657273776170222c22416d6f756e74496e555344223a2231363239352e31222c22416d6f756e744f7574555344223a2231363334332e393630323533343837383138222c22526566657272616c223a22222c22466c616773223a332c22496e74656772697479496e666f223a7b224b65794944223a2231222c225369676e6174757265223a2241765936693656494d7951477776767671476d6f41524c5773522f2b45337756737278394650694a6b4a6772705a3376376a32494c584269454a5439746b79443045724b75456a4e446471434375736c6f6b5a594c6a316739686c31374a3432624f334249594b49776754364f484159366c674644725864743653334254462f4d637651566a79486c6c454b5770687432495950665477587454487052392b63576d637461624a6d6c4c425848313450726c2b51736a6f74475855493550347139652f52626c6e4674315a5036545074554d6f376b6c4e36535a4c747052596677664e55365432544143734c5056326870626479727471742f5059692b7750526b3566616847674d43476e5935497a33314f6b71373778496465764d547267335268574c2f2b564562325539754135316374696b74626162756a766d733468783959454e70484c34514d4c6e33484c774d6544396f773d3d227d7d000000000000000000000000000000000037a0f57cd7a001f04bf54baa8fc2e8f58bc5aad18a93aa9ad7d875bc97e7c108c42fa043704a69589c066f5c84a6a12bc8401bdc827fc1aa80ab283a154ad3d9cdee71",
			expectedResult: big.NewInt(33248),
		},
		{
			name:           "it should return correct value (2)",
			rawTx:          "f90bb2808503c0781e79825208944592d8f8d7b001e72cb26a73e4fa1806a51ac79d880de0b6b3a7640000b90b44e21fd0e900000000000000000000000000000000000000000000000000000000000000200000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000009000000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c31607000000000000000000000000000000000000000000000000000000000100e0330000000000000000000000006131b5fae19ea4f9d964eac0408e4408b66337b50000000000000000000000000000000000000000000000000000000063e0c2ea0000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000000404944c8150000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001200000000000000000000000002fe45cb22f9bb58844bb6815f195a23d2c91cd840000000000000000000000004200000000000000000000000000000000000006000000000000000000000000a00e3a3511aac35ca78530c85007afcd317538190000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd000000000000000000000000000000000000000000000000002386f26fc100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000002710000000000000000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd000000000000000000000000dbaf3a3e610ee2dfadd2b02fc0f46633da8d8853000000000000000000000000a00e3a3511aac35ca78530c85007afcd3175381900000000000000000000000042000000000000000000000000000000000000420000000000000000000000000000000000000000000000010898a73701a16c6a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040a067e24b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012000000000000000000000000047029bc8f5cbe3b464004e87ef9c9419a48018cd00000000000000000000000042000000000000000000000000000000000000420000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd00000000000000000000000000000000000000000000000050a4654905b35a690000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000271000000000000000000000000000000000000000000000000000000000000000320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000006bb030922f22fed1038951bcaf6ea40983b49ab2000000000000000000000000000000000000000000000000002386f26fc10000000000000000000000000000000000000000000000000000000000000100e033000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e67b22536f75726365223a226b7962657273776170222c22416d6f756e74496e555344223a2231362e33343234222c22416d6f756e744f7574555344223a2231362e383433303239222c22526566657272616c223a22222c22466c616773223a332c22496e74656772697479496e666f223a7b224b65794944223a2231222c225369676e6174757265223a22456c53764757713171616f55426857386b6b4766446a59513150546c43325a562b615a7876476c356f444a77694b58484c357948587468486c46796c2f4e74774d4f526238335873637444326a6f682f6f3544596c68767a346350594869694f6c6e5241686264484b636c78736f2f38386933787032776168623257646e347772484e2b456c484230576d396555795a64554a654a664e415754374653445777797562356334734c6f796a4d4a424356707035447456515667626c63324a37766c4a505a5a62324b3458755a6275547859626c79795750457a4936736a6d494956657658635151565433634b774964437269694453655657574a486f386d3439306d6a5756615a5959505a7931424c6f52467a4e6b4a6c61514962375435674e62493863715a6a386d5679426c755a49736d72572b797042786a49434151622b515a76676c586a6d452f424c5778776c6873526676773d3d227d7d000000000000000000000000000000000000000000000000000037a0a20babc648e7cb884de8f8042b8fd82f67b4d5eeba096c4b93563d0ad22b4c34a0456c88a4a710483c24a65b46b0832c0b65405c06a9ac00b6b533342005e1d07d",
			expectedResult: big.NewInt(27404),
		},
	}

	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			l2FeeOptimism := NewOptimismFeeCalculator()
			l2FeeOptimism.SetParams(&entity.L2Fee{
				Decimals:  big.NewInt(6),
				L1BaseFee: big.NewInt(16113999481),
				Overhead:  big.NewInt(2100),
				Scalar:    big.NewInt(1000000),
			})

			inputData := common.FromHex(tc.rawTx)

			result := l2FeeOptimism.getL1GasUsed(inputData)

			assert.Equal(t, tc.expectedResult, result)
		})
	}
}

func TestOptimismL2FeeCalculator_GetL1Fee(t *testing.T) {
	testCases := []struct {
		name           string
		rawTx          string
		expectedResult *big.Int
	}{
		{
			name:           "it should return correct value",
			rawTx:          "f90f12808503c0781e79825208944592d8f8d7b001e72cb26a73e4fa1806a51ac79d880de0b6b3a7640000b90ea4e21fd0e900000000000000000000000000000000000000000000000000000000000000200000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000a600000000000000000000000000000000000000000000000000000000000000c6000000000000000000000000000000000000000000000000000000000000009a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c3160700000000000000000000000000000000000000000000000000000003cdbb20ea0000000000000000000000006131b5fae19ea4f9d964eac0408e4408b66337b50000000000000000000000000000000000000000000000000000000063e0bb42000000000000000000000000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000005400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd00000000000000000000000085149247691df622eaf1a8bd0cafd40bc45154a900000000000000000000000042000000000000000000000000000000000000060000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c3160700000000000000000000000000000000000000000000000075f610f70ed200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000040cbf622d3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000120000000000000000000000000b90b9b1f91a01ea22a182cd84c1e22222e39b415000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000001f32b1c2345538c0c6f582fcb022739c4a194ebb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000de0b6b3a764000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd0000000000000000000000005fc53f707c7aacd460a1cd564c06e0f07610fcb70000000000000000000000001f32b1c2345538c0c6f582fcb022739c4a194ebb0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000000000000000000000000000000c8cf311c70e030e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd00000000000000000000000095d9d28606ee55de7667f0f176ebfc3215cfd9c00000000000000000000000004200000000000000000000000000000000000006000000000000000000000000da10009cbd5d07dd0cecc66161fc93d7c9000da100000000000000000000000000000000000000000000000006f05b59d3b2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd000000000000000000000000427464d9434f99a3d942c60210ee2376166975ce000000000000000000000000da10009cbd5d07dd0cecc66161fc93d7c9000da10000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c3160700000000000000000000000000000000000000000000002c4ecdb290026862e20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000006bb030922f22fed1038951bcaf6ea40983b49ab20000000000000000000000000000000000000000000000008ac7230489e8000000000000000000000000000000000000000000000000000000000003cdbb20ea000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ef7b22536f75726365223a226b7962657273776170222c22416d6f756e74496e555344223a2231363239352e31222c22416d6f756e744f7574555344223a2231363334332e393630323533343837383138222c22526566657272616c223a22222c22466c616773223a332c22496e74656772697479496e666f223a7b224b65794944223a2231222c225369676e6174757265223a2241765936693656494d7951477776767671476d6f41524c5773522f2b45337756737278394650694a6b4a6772705a3376376a32494c584269454a5439746b79443045724b75456a4e446471434375736c6f6b5a594c6a316739686c31374a3432624f334249594b49776754364f484159366c674644725864743653334254462f4d637651566a79486c6c454b5770687432495950665477587454487052392b63576d637461624a6d6c4c425848313450726c2b51736a6f74475855493550347139652f52626c6e4674315a5036545074554d6f376b6c4e36535a4c747052596677664e55365432544143734c5056326870626479727471742f5059692b7750526b3566616847674d43476e5935497a33314f6b71373778496465764d547267335268574c2f2b564562325539754135316374696b74626162756a766d733468783959454e70484c34514d4c6e33484c774d6544396f773d3d227d7d000000000000000000000000000000000037a0f57cd7a001f04bf54baa8fc2e8f58bc5aad18a93aa9ad7d875bc97e7c108c42fa043704a69589c066f5c84a6a12bc8401bdc827fc1aa80ab283a154ad3d9cdee71",
			expectedResult: big.NewInt(535758254744288),
		},
		{
			name:           "it should return correct value (2)",
			rawTx:          "f90bb2808503c0781e79825208944592d8f8d7b001e72cb26a73e4fa1806a51ac79d880de0b6b3a7640000b90b44e21fd0e900000000000000000000000000000000000000000000000000000000000000200000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000009000000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c31607000000000000000000000000000000000000000000000000000000000100e0330000000000000000000000006131b5fae19ea4f9d964eac0408e4408b66337b50000000000000000000000000000000000000000000000000000000063e0c2ea0000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000000404944c8150000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001200000000000000000000000002fe45cb22f9bb58844bb6815f195a23d2c91cd840000000000000000000000004200000000000000000000000000000000000006000000000000000000000000a00e3a3511aac35ca78530c85007afcd317538190000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd000000000000000000000000000000000000000000000000002386f26fc100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000002710000000000000000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000409e8aa9350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd000000000000000000000000dbaf3a3e610ee2dfadd2b02fc0f46633da8d8853000000000000000000000000a00e3a3511aac35ca78530c85007afcd3175381900000000000000000000000042000000000000000000000000000000000000420000000000000000000000000000000000000000000000010898a73701a16c6a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040a067e24b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012000000000000000000000000047029bc8f5cbe3b464004e87ef9c9419a48018cd00000000000000000000000042000000000000000000000000000000000000420000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000001d5702c6d7eb30e42a8c94b8db7ea2e8444a37fd00000000000000000000000000000000000000000000000050a4654905b35a690000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000271000000000000000000000000000000000000000000000000000000000000000320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000006bb030922f22fed1038951bcaf6ea40983b49ab2000000000000000000000000000000000000000000000000002386f26fc10000000000000000000000000000000000000000000000000000000000000100e033000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e67b22536f75726365223a226b7962657273776170222c22416d6f756e74496e555344223a2231362e33343234222c22416d6f756e744f7574555344223a2231362e383433303239222c22526566657272616c223a22222c22466c616773223a332c22496e74656772697479496e666f223a7b224b65794944223a2231222c225369676e6174757265223a22456c53764757713171616f55426857386b6b4766446a59513150546c43325a562b615a7876476c356f444a77694b58484c357948587468486c46796c2f4e74774d4f526238335873637444326a6f682f6f3544596c68767a346350594869694f6c6e5241686264484b636c78736f2f38386933787032776168623257646e347772484e2b456c484230576d396555795a64554a654a664e415754374653445777797562356334734c6f796a4d4a424356707035447456515667626c63324a37766c4a505a5a62324b3458755a6275547859626c79795750457a4936736a6d494956657658635151565433634b774964437269694453655657574a486f386d3439306d6a5756615a5959505a7931424c6f52467a4e6b4a6c61514962375435674e62493863715a6a386d5679426c755a49736d72572b797042786a49434151622b515a76676c586a6d452f424c5778776c6873526676773d3d227d7d000000000000000000000000000000000000000000000000000037a0a20babc648e7cb884de8f8042b8fd82f67b4d5eeba096c4b93563d0ad22b4c34a0456c88a4a710483c24a65b46b0832c0b65405c06a9ac00b6b533342005e1d07d",
			expectedResult: big.NewInt(441588041777324),
		},
	}

	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			l2FeeOptimism := NewOptimismFeeCalculator()
			l2FeeOptimism.SetParams(&entity.L2Fee{
				Decimals:  big.NewInt(6),
				L1BaseFee: big.NewInt(16113999481),
				Overhead:  big.NewInt(2100),
				Scalar:    big.NewInt(1000000),
			})

			inputData := common.FromHex(tc.rawTx)

			result := l2FeeOptimism.GetL1Fee(inputData)

			assert.Equal(t, tc.expectedResult, result)
		})
	}
}
